<div style="margin-top:10px;"></div>
<header>
    <div th:replace="~{layouts/info/_header.html}"></div>
<meta name="theme-color" content="#E60012" />
<link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23E60012'/%3E%3Ctext x='50' y='58' font-size='56' text-anchor='middle' fill='white' font-family='Arial, Helvetica, sans-serif'%3EB%3C/text%3E%3C/svg%3E" />
<style>
    body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #F6F6F8;
        margin: 0;
        padding: 0;
        color: #222;
        line-height: 1.7;
    }

    header,
    nav,
    main {
        max-width: 1200px;
        background-color: #F6F6F8;
        margin: 0 auto;
        padding: 30px 20px;
    }


    h2 {
        font-size: 1.6rem;
        font-weight: 700;
        margin: 40px 0 10px;
        border-bottom: 2px solid #d91a1a;
        display: inline-block;
        padding-bottom: 5px;
    }
    .branch-layout {
        display: flex;
        gap: 30px;
        margin-top: 30px;
        width: 100%;
        height: 780px; /* 전체 높이 */
    }

    /* 왼쪽: 메뉴 + 검색 + 리스트 */
    .branch-left {
        flex: 1 1 45%;
        display: flex;
        flex-direction: column;
        height: 100%;
        overflow: hidden;
        padding-right: 6px;
    }

    /* 오른쪽 지도 */
    .branch-map-area {
        flex: 1 1 55%;
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* 검색 UI */
    .branch-search-wrapper {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .branch-select {
        border: 1.5px solid #ddd;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
        background: #fff;
        cursor: pointer;
        width: 140px;
    }

    .branch-search-box {
        flex: 1;
        display: flex;
        align-items: center;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 8px;
        background: #fafafa;
    }

    .branch-search-box input {
        flex: 1;
        border: none;
        background: transparent;
        font-size: 15px;
        outline: none;
    }

    .branch-search-box button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        color: #D91A1A;
    }

    /* 리스트 스크롤 */
    .branch-list-box {
        flex: 1;
        margin-top: 15px;
        overflow-y: auto;
        padding-right: 8px;
    }

    /* 카드형 리스트 */
    .branch-result-item {
        background:#fff;
        border-radius:8px;
        border:1px solid #eee;
        padding:18px 20px;
        margin-bottom:14px;
        box-shadow:0 2px 4px rgba(0,0,0,0.05);
        cursor:pointer;
    }

    .branch-result-item:hover {
        background:#fff6f6;
    }

    .branch-result-item h3 {
        font-size:18px;
        font-weight:700;
        color:#d91a1a;
        margin-bottom:6px;
    }

    .branch-result-item .info {
        font-size:14px;
        color:#333;
        line-height:1.6;
    }

    .branch-result-item .waiting {
        font-size:14px;
        margin-top:8px;
        color:#d91a1a;
        font-weight:600;
    }

</style>
</header>

<!-- 전체 레이아웃 -->
<div class="branch-layout">

    <!-- ⭐ 왼쪽 : 메뉴검색 + 검색박스 + 리스트 -->
    <div class="branch-left">

        <!-- 메뉴 탭 -->
        <div class="tab-menu">
            <button class="active" data-type="branch">영업점</button>
            <button data-type="365">365코너</button>
            <button data-type="24">24/365코너</button>
            <button data-type="safe">대여금고</button>
            <button data-type="fx">외화ATM</button>
        </div>

        <!-- 검색 조건 -->
        <div class="branch-search-wrapper">
            <select id="citySelect" class="branch-select">
                <option value="">시/도 선택</option>
                <option value="부산광역시">부산광역시</option>
            </select>

            <select id="districtSelect" class="branch-select">
                <option value="">구/군 선택</option>
            </select>



            <div class="branch-search-box">
                <input type="text" id="keywordInput" placeholder="지점명 또는 주소 검색">
                <button id="searchBtn"><i class="fas fa-search"></i></button>
            </div>
        </div>

        <!-- 검색 결과 -->
        <div class="branch-count">
            총 <strong id="branchTotal">0</strong> 건
        </div>

        <!-- 리스트 -->
        <div id="branchList" class="branch-list-box"></div>

    </div>

    <!-- ⭐ 오른쪽 : 지도 -->
    <div class="branch-map-area">
        <iframe id="branchMap"
                src="https://map.kakao.com/?q=부산은행%20본점"
                width="100%" height="100%" style="border:0;" loading="lazy"></iframe>
    </div>

</div>

</main>

<footer style="margin-top: 50px;">
    <div th:replace="~{layouts/footer.html}"></div>
</footer>

<script>
    document.addEventListener("DOMContentLoaded", async () => {

        let branchData = [];

        // 1) API 호출
        try {
            const res = await fetch('/BNK/api/branch');
            branchData = await res.json();
        } catch (e) {
            alert("지점 정보를 불러올 수 없습니다.");
            return;
        }

        const city = document.getElementById("citySelect");
        const district = document.getElementById("districtSelect");
        const keyword = document.getElementById("keywordInput");
        const searchBtn = document.getElementById("searchBtn");

        const listBox = document.getElementById("branchList");
        const mapIframe = document.getElementById("branchMap");
        const totalBox = document.getElementById("branchTotal");

        /* ⭐ 부산 전체 구군 동적 추가 */
        const districts = [
            "중구","서구","동구","영도구","부산진구","동래구",
            "남구","북구","해운대구","사하구","금정구",
            "강서구","연제구","수영구","사상구","기장군"
        ];
        districts.forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            opt.textContent = name;
            district.appendChild(opt);
        });
        /* ⭐ 끝 */

        /* ⭐ 탭 메뉴 이벤트 */
        const tabButtons = document.querySelectorAll(".tab-menu button");
        let currentType = "영업점";

        tabButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                tabButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                currentType = btn.textContent;
                filter();
            });
        });

        function renderList(data) {
            totalBox.textContent = data.length;
            listBox.innerHTML = "";

            if (data.length === 0) {
                listBox.innerHTML = `<div style="padding:20px;color:#999;">검색 결과가 없습니다.</div>`;
                return;
            }

            data.forEach(b => {
                const html = `
            <div class="branch-result-item" data-name="${b.brname}">
                <h3>${b.brname}</h3>
                <div class="info">
                    ☎ ${b.brtel}<br>
                    ${b.braddr}
                </div>
                <div class="service-icons">
                    서비스: ${b.service || "정보 없음"}
                </div>
                <div class="waiting">
                    대기고객: ${b.wait || 0}명
                </div>
            </div>`;
                listBox.insertAdjacentHTML("beforeend", html);
            });

            document.querySelectorAll(".branch-result-item").forEach(item => {
                item.addEventListener("click", () => {
                    const q = encodeURIComponent(`부산은행 ${item.dataset.name}`);
                    mapIframe.src = `https://map.kakao.com/?q=${q}`;
                });
            });
        }

        function filter() {
            let fd = [...branchData];

            if (currentType !== "영업점") {
                fd = fd.filter(b => b.type === currentType);
            }

            const c = city.value;
            const d = district.value;
            const k = keyword.value.trim();

            fd = fd.filter(b => {
                const addr = b.braddr || "";
                const okCity = c ? addr.includes(c) : true;
                const okDist = d ? addr.includes(d) : true;
                const okKeyword = k ? (b.brname.includes(k) || addr.includes(k)) : true;
                return okCity && okDist && okKeyword;
            });

            renderList(fd);
        }

        city.addEventListener("change", filter);
        district.addEventListener("change", filter);
        searchBtn.addEventListener("click", filter);
        keyword.addEventListener("keydown", e => { if (e.key === "Enter") filter(); });

        renderList(branchData);
    });
</script>
