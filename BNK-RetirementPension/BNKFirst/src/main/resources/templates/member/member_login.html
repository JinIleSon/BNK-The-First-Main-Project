<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ë¡œê·¸ì¸</title>
</head>
<body>
<div th:replace="~{layouts/header.html}"></div>

<div id="bnk-chatbot-container" style="position: fixed; right: 20px; bottom: 20px; z-index: 9999;">
    <div id="bnk-chatbot-slot"></div>
</div>
<script>
    /**
     * ì™¸ë¶€ HTMLì„ ë¶ˆëŸ¬ì™€ì„œ:
     *  - <link rel="stylesheet">, <style>ëŠ” <head>ë¡œ ì˜®ê¸°ê³ 
     *  - <script>ëŠ” ì‹¤í–‰ë˜ë„ë¡ ìƒˆë¡œ ë§Œë“¤ì–´ ë¶™ì´ê³  (src/inline, module ëª¨ë‘ ì§€ì›)
     *  - ë‚˜ë¨¸ì§€ DOM(ì˜ˆ: <flowise-chatbot> / <flowise-embed>)ì€ mountì— ì‚½ì…
     */
    async function importHtmlWithAssets(url, mountSelector) {
        const res = await fetch(url, { credentials: 'same-origin' });
        if (!res.ok) throw new Error(`Failed to load ${url}`);
        const html = await res.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

// 1) <link rel="stylesheet"> ë“¤ì„ <head>ë¡œ
        doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
            // ì¤‘ë³µ ë¡œë“œ ë°©ì§€
            const href = link.getAttribute('href');
            if (href && ![...document.head.querySelectorAll('link[rel="stylesheet"]')]
                .some(l => l.getAttribute('href') === href)) {
                document.head.appendChild(link.cloneNode(true));
            }
        });

// 2) <style> ë“¤ì„ <head>ë¡œ
        doc.querySelectorAll('style').forEach(styleEl => {
            const clone = document.createElement('style');
            // CSS í…ìŠ¤íŠ¸ ë³´ì¡´
            clone.textContent = styleEl.textContent;
            // (ê°€ëŠ¥í•œ ì†ì„± ë³µì‚¬)
            [...styleEl.attributes].forEach(a => clone.setAttribute(a.name, a.value));
            document.head.appendChild(clone);
        });

// 3) ë³¸ë¬¸ ì½˜í…ì¸ ë¥¼ mountì— ë¶™ì„ (ìŠ¤í¬ë¦½íŠ¸ ì œì™¸)
        const mount = document.querySelector(mountSelector);
// fragment êµ¬ì„±
        const frag = document.createDocumentFragment();
        [...doc.body.children].forEach(node => {
            if (node.tagName.toLowerCase() !== 'script') frag.appendChild(node.cloneNode(true));
        });
        mount.appendChild(frag);

// 4) ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (src/inline/module ì§€ì›, ìˆœì„œ ë³´ì¥)
        const scripts = [...doc.querySelectorAll('script')];
        for (const oldScript of scripts) {
            const newScript = document.createElement('script');
            // type/module/defer ë“± ì†ì„± ë³µì‚¬
            [...oldScript.attributes].forEach(attr => newScript.setAttribute(attr.name, attr.value));
            if (oldScript.src) {
                // ë„¤íŠ¸ì›Œí¬ ë¡œë“œë¥¼ ê¸°ë‹¤ë ¤ ì‹¤í–‰ ìˆœì„œ ìœ ì§€
                await new Promise((resolve, reject) => {
                    newScript.onload = resolve;
                    newScript.onerror = resolve;   // ì‹¤íŒ¨í•´ë„ ì§„í–‰(ë¸Œëœë”© ì œê±° ê°™ì€ ì„ íƒ ê¸°ëŠ¥ ë³´í˜¸)
                    document.body.appendChild(newScript);
                });
            } else {
                // inline ì½”ë“œ ë³µì‚¬
                newScript.textContent = oldScript.textContent || '';
                document.body.appendChild(newScript);
            }
        }
    }

    // ì‹¤ì œ í˜¸ì¶œ: ê¸°ì¡´ chatbot.html(ë˜ëŠ” chatbot_test.html) ê²½ë¡œë¡œ ë°”ê¿”ë„ ë©ë‹ˆë‹¤.
    importHtmlWithAssets('/components/chatbot_test.html', '#bnk-chatbot-slot')
        .catch(err => console.error('[Chatbot load failed]', err));
</script>

<main>
    <div class="container">
        <!-- ë¡œê·¸ì¸ í¼ -->
        <section style="width: 580px; margin: 0 auto; margin-top: 30px;">

            <!-- ê°ì‹¸ê¸° -->
            <div class="form-card" style="height: 720px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; line-height: 1.6;">

                <form th:action="@{/member/main}" th:object="${userDTO}" method="post">
                    <!-- ë¡œê·¸ì¸ í…Œì´ë¸” -->
                    <table class="login-table">
                        <tr style="font-size: 25px;">
                            <td>ë¡œê·¸ì¸</td>
                        </tr>
                        <tr>
                            <td style="padding: 0 0 9px;">BNK ë¶€ì‚°ì€í–‰ì€ ê³ ê°ë‹˜ì˜ ì •ë³´ë¥¼ ì†Œì¤‘íˆ ë³´í˜¸í•©ë‹ˆë‹¤</td>
                        </tr>
                        <tr class="field-row">
                            <td class="field-label">ì•„ì´ë””</td>
                        </tr>
                        <tr class="field-row">
                            <td style="margin-bottom: 9px;">
                                <input type="text" th:field="*{mid}" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="username">
                            </td>
                        </tr>
                        <tr class="field-row">
                            <td class="field-label">ë¹„ë°€ë²ˆí˜¸</td>
                        </tr>
                        <tr class="field-row">
                            <td style="margin-bottom: 19px;">
                                <input type="password" th:field="*{mpw}" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="current-password">
                            </td>
                        </tr>

                        <tr>
                            <td class="field-td" style="border-bottom: 1px solid #ddd;">
                                <button id="loginBtn" class="btn-pressable btn-sheen" style="box-sizing:border-box;width:500px;height:42px;border:none;border-radius:8px; cursor:pointer;border:1px solid #D1D5DB;background-color:white;">
                                    ë¡œê·¸ì¸
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td class="field-td">
                                <button class="btn-register" style="width: 500px;">ê³µì¸ì¸ì¦ì„œ ë¡œê·¸ì¸</button>
                            </td>
                        </tr>
                        <tr>
                            <td class="field-td">
                                <button class="btn-register" style="width: 500px;">ê°„í¸ì¸ì¦ìœ¼ë¡œ ë¡œê·¸ì¸</button>
                            </td>
                        </tr>
                        <tr>
                            <td class="field-td">
                                <a th:href="@{/member/findid}">ì•„ì´ë”” ì°¾ê¸°</a>
                                <span class="sep-dot">Â·</span>
                                <a th:href="@{/member/findpw}">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                                <span class="sep-dot">Â·</span>
                                <a th:href="@{/member/terms}">íšŒì›ê°€ì…</a>
                            </td>
                        </tr>

                        <tr class="notice">
                            <td style="text-align: left; color: #444; font-size: 15px; line-height: 1.6;">
                                <span>ğŸ”’ ë³´ì•ˆ ì•ˆë‚´</span><br>
                                â€¢ ê°œì¸ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ê³µìš© PCì—ì„œëŠ” ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ë¥¼ í•´ì œí•˜ì„¸ìš”.<br>
                                â€¢ ë¹„ë°€ë²ˆí˜¸ëŠ” ì •ê¸°ì ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </section>
    </div>
</main>
<footer><div th:replace="~{layouts/footer.html}"></div></footer>
</body>

<style>
    main {
        width: 1200px;
        background-color: #F6F6F8;
        padding: 80px 20px;
        margin: 0 auto;
    }
    body {
        font-family: 'Noto Sans KR', 'ë§‘ì€ ê³ ë”•', sans-serif;
        background: #F6F6F8;
        color: #111827;
        line-height: 1.5;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 28px 16px 40px; }

    a { text-decoration: none; color: inherit; }

    .input:focus,
    .field-row input:focus,
    .field-td input:focus {
        border-color: #d1d5db;
        box-shadow: 0 0 0 3px rgba(214,0,28,.12);
        outline: none;
    }

    /* ê°ì‹¸ëŠ” */
    .form-card {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 20px;
        box-shadow: 0 10px 20px rgba(2,6,23,.06);
        padding: 28px 30px;
        margin-bottom: 24px;
    }

    .field-td {
        text-align: center;
        padding: 10px;
    }

    .field-td input {
        width: 400px;
        height: 44px;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        box-sizing: border-box;
        padding: 0 12px;
        outline: none;
    }
    .sep-dot{ margin: 0 8px; }

    .notice {
        margin-top: 15px;
        background: #eef4ff;
        border: 1px solid #c7d7ff;
        color: #1f3b8f;
        border-radius: 12px;
        padding: 20px 30px;
        display: flex;
        gap: 8px;
    }

    .field-row {
        display: flex;
        margin: 5px;
    }

    .field-row input {
        width: 500px;
        height: 25px;
        border: 1px solid #bbb;
        padding: 10px;
        border-radius: 10px;
    }

    .field-label {
        font-size: 18px;
    }

</style>
</html>