<script type="module">
      import Chatbot from "https://cdn.jsdelivr.net/npm/flowise-embed/dist/web.js"

      Chatbot.init({
        chatflowid: "c5c35ce4-18cb-4928-b072-f805252e5889",
        apiHost: "https://cloud.flowiseai.com",
        

        // RAG/ëª¨ë¸ íŒŒë¼ë¯¸í„° â†“ (í•„ìš” ì—†ìœ¼ë©´ ë¹„ì›Œë‘¬ë„ ë©ë‹ˆë‹¤)
        chatflowConfig: {
            returnSourceDocuments: false,   // "question:..." ì¹© ì œê±°
        },

        // ğŸ”µ UI/ë¬¸êµ¬ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ
        theme: {
          button: { backgroundColor: "#D81921", color: "#fff" },
          chatWindow: {
            title: "BNK ì±—ë´‡",
            welcomeMessage: "ì•ˆë…•í•˜ì„¸ìš”! BNK FAQ ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?",
            inputPlaceholder: "ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",
            backgroundColor: "#ffffff",
            fontSize: "15px",
            // ìƒ˜í”Œ ì§ˆë¬¸
            starterPrompts: [
                "ê³„ì¢Œ ê°œì„¤ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?",
                "ì²´í¬ì¹´ë“œ ì¬ë°œê¸‰ ë°©ë²• ì•Œë ¤ì¤˜ìš”",
                "ì˜ˆê¸ˆ ê¸ˆë¦¬ëŠ” ì–´ë””ì„œ í™•ì¸í•  ìˆ˜ ìˆë‚˜ìš”?",
                "ë¹„ëŒ€ë©´ ê³„ì¢Œ ê°œì„¤ ì‹œ í•„ìš”í•œ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"
            ],
            starterPromptFontSize: 15, // ì¹© ê¸€ì í¬ê¸°
            botMessage: { backgroundColor: "#f3f6ff" },
            userMessage: { backgroundColor: "#0064FF", textColor: "#ffffff" },
            // ğŸ”´ íƒ€ì´í‹€ ë°” ìƒ‰ìƒ ë³€ê²½
            header: { backgroundColor: "#D81921", textColor: "#ffffff" },
            // ğŸ”´ ì…ë ¥ì°½ í™”ì‚´í‘œ ìƒ‰ìƒ ë³€ê²½
            sendButtonColor: "#D81921"
          }
        }
      })

  const getWidget = () =>
    document.querySelector('flowise-chatbot, flowise-embed')

  // ğŸ”§ "Powered by ..." ì¤„ì„ í…ìŠ¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì°¾ì•„ ìŠ¤í˜ì´ì„œë¡œ êµì²´
  const nukeBrandingKeepGap = () => {
    const host = getWidget()
    const root = host && host.shadowRoot
    if (!root) return

    // 1) ë§í¬ë¡œ ë¨¼ì € ì‹œë„
    let brandNode = root.querySelector('a[href*="flowise"]')

    // 2) ë§í¬ê°€ ì—†ë‹¤ë©´ í…ìŠ¤íŠ¸ë¡œ íƒìƒ‰
    if (!brandNode) {
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT)
      let t
      while ((t = walker.nextNode())) {
        const s = t.textContent.trim().toLowerCase()
        if (s.includes('powered by')) {
          brandNode = t.parentElement
          break
        }
      }
    }
    if (!brandNode) return

    // 3) ì¤„ ì»¨í…Œì´ë„ˆ(ê°€ì¥ ê°€ê¹Œìš´ ì‘ì€ block ìš”ì†Œ)ë¥¼ ì°¾ìŒ
    let row = brandNode
    const isSmall = el => {
      const r = el.getBoundingClientRect()
      return r.height > 10 && r.height < 60 && r.width > 150
    }
    while (row && row !== root && !isSmall(row)) row = row.parentElement
    if (!row) row = brandNode.parentElement

    // 4) ê°™ì€ ë†’ì´ì˜ ìŠ¤í˜ì´ì„œë¡œ êµì²´
    const h = (row.getBoundingClientRect().height || 28)
    const spacer = document.createElement('div')
    spacer.setAttribute('aria-hidden', 'true')
    spacer.style.height = h + 'px'
    spacer.style.opacity = '0'
    spacer.style.pointerEvents = 'none'
    row.replaceWith(spacer)
  }

  // ìµœì´ˆ ì ìš© + ë³€ê²½ ê°ì‹œ(í…ìŠ¤íŠ¸/ì†ì„± í¬í•¨)ë¡œ ì¬ì ìš©
  const start = () => {
    const host = getWidget()
    if (!host || !host.shadowRoot) return false
    nukeBrandingKeepGap()
    const obs = new MutationObserver(nukeBrandingKeepGap)
    obs.observe(host.shadowRoot, {
      childList: true,
      characterData: true,
      attributes: true,
      subtree: true
    })
    return true
  }
  const boot = setInterval(() => { if (start()) clearInterval(boot) }, 300)

  // (ì„ íƒ) ì¹© ì œê±° ìœ ì§€
  const hideChips = () => {
    const host = getWidget()
    const root = host && host.shadowRoot
    if (!root) return
    root.querySelectorAll('.chatbot-button.selectable').forEach(n => n.remove())
  }
  setInterval(hideChips, 300)
    </script>
    <style>
        /* Flowise ì¹©/ì¶”ì²œ ë²„íŠ¼ë“¤ ì „ë¶€ ìˆ¨ê¹€ */
        .flowise-message-chips,
        .flowise-starter-prompts,
        .message-chips,
        .starter-prompts,
        .chips, .chip, .flowise-chip,
        div[class*="starterPrompt"],
        div[class*="message-suggestion"],
        div[class*="chip"] {
            display: none !important;
        }
    </style>

    <style>
      /* íƒ€ì´í‹€ ë°” */
      flowise-chatbot::part(header),
      flowise-embed::part(header) {
        background: #D81921 !important;
        color: #fff !important;
      }

      /* ì „ì†¡ ë²„íŠ¼(í™”ì‚´í‘œ) */
      flowise-chatbot::part(send-button),
      flowise-embed::part(send-button) {
        color: #D81921 !important;
        fill: #D81921 !important;
      }
    </style>
    

    <style th:inline="css">
      /* ğŸ”´ Flowise ì±—ë´‡ ë²„íŠ¼ì„ ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ë¡œ êµì²´ */
      flowise-chatbot::part(button) {
        background-image: url([[@{/images/chatbot.png}]]); /* ì—…ë¡œë“œí•œ ê²½ë¡œë¡œ ìˆ˜ì • */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-color: transparent !important;
        border: none !important;
      }

      /* ì›í˜• ìœ ì§€ ë° ê·¸ë¦¼ì ì‚´ì§ */
      flowise-chatbot::part(button):hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }
      /* ğŸ”§ Flowise ì±—ë´‡ ë²„íŠ¼ ì•„ë˜ ìƒê¸°ëŠ” í°ìƒ‰ ê¼¬ë¦¬(âˆ¨, < ëª¨ì–‘) ì œê±° */
      flowise-chatbot::part(host-bubble)::before,
      flowise-chatbot::part(host-bubble)::after,
      flowise-embed::part(host-bubble)::before,
      flowise-embed::part(host-bubble)::after {
        display: none !important;
        content: none !important;
      }

      /* í˜¹ì‹œ í™”ì‚´í‘œë¥¼ ë§Œë“œëŠ” ë‚´ë¶€ divê°€ ìˆì„ ê²½ìš° ëŒ€ë¹„ */
      flowise-chatbot::part(host-bubble),
      flowise-embed::part(host-bubble) {
        overflow: visible;
      }
    </style>
<script>
    // ì»¤ìŠ¤í…€ ë²„íŠ¼ ì•„ì´ì½˜ ì ìš©
    // const applyCustomChatbotButton = () => {
    //     const host = document.querySelector('flowise-chatbot, flowise-embed')
    //     const root = host && host.shadowRoot
    //     if (!root) return
    //
    //     // ë²„íŠ¼ í›„ë³´ (ë²„ì „ë³„ë¡œ í´ë˜ìŠ¤ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ ì—¬ëŸ¬ ê°œ íƒìƒ‰)
    //     const btn =
    //         root.querySelector('[part="button"]') ||
    //         root.querySelector('button') ||
    //         root.querySelector('.chatbot-button') ||
    //         root.querySelector('[class*="button"]')
    //     if (!btn) return
    //
    //     // ê¸°ë³¸ ì•„ì´ì½˜/ì´ë¯¸ì§€ ê°€ë¦¬ê¸°(SVG, IMG, I ë“±)
    //     btn.querySelectorAll('svg, img, i, span[class*="icon"]').forEach(n => {
    //         n.style.display = 'none'
    //     })
    //
    //     // ë°°ê²½ ìŠ¤íƒ€ì¼ ê°•ì œ
    //     btn.style.backgroundImage = "url('/images/chatbot.png')"   // ğŸ‘‰ ê²½ë¡œ ìœ ì§€
    //     btn.style.backgroundSize = 'cover'
    //     btn.style.backgroundPosition = 'center'
    //     btn.style.backgroundRepeat = 'no-repeat'
    //     btn.style.backgroundColor = 'transparent'
    //     btn.style.border = 'none'
    //     btn.style.outline = 'none'
    //     btn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)'
    //     btn.style.padding = '0'
    //
    //     // í¬ê¸°/ëª¨ì–‘ ë³´ì •
    //     btn.style.width = '64px'
    //     btn.style.height = '64px'
    //     btn.style.borderRadius = '50%'
    //
    //     // ë²„íŠ¼ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆê°€ ë°°ê²½ì„ ë®ëŠ” ê²½ìš° ëŒ€ë¹„
    //     const container =
    //         btn.parentElement && btn.parentElement.shadowRoot ? null : btn.parentElement
    //     if (container) {
    //         container.style.background = 'transparent'
    //         container.style.boxShadow = 'none'
    //     }
    // }

    // ìµœì´ˆ ì ìš© + ë³€ê²½ ê°ì§€(ë Œë”ë§ì´ ë°”ë€Œì–´ë„ ì¬ì ìš©)
    const startCustomButton = () => {
        const host = document.querySelector('flowise-chatbot, flowise-embed')
        if (!host || !host.shadowRoot) return false
        applyCustomChatbotButton()
        const obs = new MutationObserver(applyCustomChatbotButton)
        obs.observe(host.shadowRoot, { childList: true, subtree: true })
        return true
    }
    const bootBtn = setInterval(() => { if (startCustomButton()) clearInterval(bootBtn) }, 300);
        (function strongOverride(){
            const CSS = `
  /* 1) ë²„íŠ¼/ë§í’ì„  ì»¨í…Œì´ë„ˆ ë°°ê²½/ê·¸ë¦¼ì ì œê±° */
  [part="host-bubble"], [class*="bubble"], [class*="host"] {
    background: transparent !important;
    box-shadow: none !important;
  }
  /* 2) ë²„íŠ¼ í›„ë³´ë“¤ì— ìš°ë¦¬ ì´ë¯¸ì§€ ê°•ì œ */
  [part="button"], button, .chatbot-button, [class*="button"] {
    width: 64px !important;
    height: 64px !important;
    border-radius: 50% !important;
    background-image: url('/images/chatbot.png') !important;
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
    background-color: transparent !important;
    border: none !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
    padding: 0 !important;
  }
  /* 3) ê¸°ë³¸ ì•„ì´ì½˜/ë ˆì´ì–´ ìˆ¨ê¹€ */
  [part="button"] svg, [part="button"] img, [part="button"] i,
  button svg, button img, button i,
  .chatbot-button svg, .chatbot-button img, .chatbot-button i,
  [class*="button"] svg, [class*="button"] img, [class*="button"] i {
    display: none !important;
  }
  /* 4) ì˜ì‚¬ìš”ì†Œë¡œ ê·¸ë¦° ë§í’ì„ /ê¼¬ë¦¬ë„ ì œê±° */
  [part="button"]::before, [part="button"]::after,
  [part="host-bubble"]::before, [part="host-bubble"]::after {
    display: none !important; content: none !important;
  }`;

            const inject = () => {
                const host = document.querySelector('flowise-chatbot, flowise-embed')
                const root = host && host.shadowRoot
                if (!root) return false

                // ì¤‘ë³µ ì£¼ì… ë°©ì§€
                if (root.getElementById('flowise-strong-override')) return true;

                const style = document.createElement('style')
                style.id = 'flowise-strong-override'
                style.textContent = CSS
                root.appendChild(style)

                // ë Œë” ë³€ê²½ì—ë„ ìœ ì§€
                const obs = new MutationObserver(() => {
                    if (!root.getElementById('flowise-strong-override')) {
                        root.appendChild(style)
                    }
                })
                obs.observe(root, { childList: true, subtree: true })
                return true
            }

            const boot = setInterval(() => { if (inject()) clearInterval(boot) }, 300)
        })();
</script>